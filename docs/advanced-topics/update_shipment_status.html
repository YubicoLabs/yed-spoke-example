<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-advanced-topics/update_shipment_status">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Open incident on shipment error | YubiEnterprise Delivery + ServiceNow Example</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://yubicolabs.github.io/yed-spoke-example/img/yubico-logo.png"><meta data-rh="true" name="twitter:image" content="https://yubicolabs.github.io/yed-spoke-example/img/yubico-logo.png"><meta data-rh="true" property="og:url" content="https://yubicolabs.github.io/yed-spoke-example/docs/advanced-topics/update_shipment_status"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Open incident on shipment error | YubiEnterprise Delivery + ServiceNow Example"><meta data-rh="true" name="description" content="Now that you have created a workflow to create a shipment using the YubiEnterprise Delivery API, let’s use what we&#x27;ve learned to open an incident if the shipment failed after creation. This page will use concepts taught in the previous sections such as creating an action, updating and configuring a flow, as well as calling the YubiEnterprise API."><meta data-rh="true" property="og:description" content="Now that you have created a workflow to create a shipment using the YubiEnterprise Delivery API, let’s use what we&#x27;ve learned to open an incident if the shipment failed after creation. This page will use concepts taught in the previous sections such as creating an action, updating and configuring a flow, as well as calling the YubiEnterprise API."><link data-rh="true" rel="icon" href="/yed-spoke-example/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://yubicolabs.github.io/yed-spoke-example/docs/advanced-topics/update_shipment_status"><link data-rh="true" rel="alternate" href="https://yubicolabs.github.io/yed-spoke-example/docs/advanced-topics/update_shipment_status" hreflang="en"><link data-rh="true" rel="alternate" href="https://yubicolabs.github.io/yed-spoke-example/docs/advanced-topics/update_shipment_status" hreflang="x-default"><link rel="stylesheet" href="/yed-spoke-example/assets/css/styles.319d6c73.css">
<link rel="preload" href="/yed-spoke-example/assets/js/runtime~main.66cb5edb.js" as="script">
<link rel="preload" href="/yed-spoke-example/assets/js/main.5567d05f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/yed-spoke-example/"><div class="navbar__logo"><img src="/yed-spoke-example/img/yubico-logo.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/yed-spoke-example/img/yubico-logo.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">YubiEnterprise Delivery ServiceNow Example</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/yed-spoke-example/docs/intro">Tutorial</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/YubicoLabs/yed-spoke-example" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/yed-spoke-example/docs/intro">YubiEnterprise Delivery API ServiceNow Integration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/yed-spoke-example/docs/prereqs">Prerequisites</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/yed-spoke-example/docs/scoped_app">Create a scoped application</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/yed-spoke-example/docs/catalog">Create catalog item</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/yed-spoke-example/docs/connections">Configure connection credentials</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/yed-spoke-example/docs/action">Create a custom action</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/yed-spoke-example/docs/flow">Create a custom flow</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/yed-spoke-example/docs/category/advanced-use-cases">Advanced use cases</a><button aria-label="Toggle the collapsible sidebar category &#x27;Advanced use cases&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/yed-spoke-example/docs/advanced-topics/update_shipment_status">Open incident on shipment error</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/yed-spoke-example/docs/advanced-topics/low_inventory_monitor">Monitor for low organizational inventory</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/yed-spoke-example/docs/category/fido-pre-reg">FIDO Pre-reg</a><button aria-label="Toggle the collapsible sidebar category &#x27;FIDO Pre-reg&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/yed-spoke-example/docs/references">References</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/yed-spoke-example/docs/help_and_support">Help &amp; support</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/yed-spoke-example/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/yed-spoke-example/docs/category/advanced-use-cases"><span itemprop="name">Advanced use cases</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Open incident on shipment error</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Open incident on shipment error</h1><p>Now that you have created a workflow to create a shipment using the YubiEnterprise Delivery API, let’s use what we&#x27;ve learned to open an incident if the shipment failed after creation. This page will use concepts taught in the previous sections such as creating an action, updating and configuring a flow, as well as calling the YubiEnterprise API.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-an-action-to-get-shipment-details">Create an action to get shipment details<a href="#create-an-action-to-get-shipment-details" class="hash-link" aria-label="Direct link to Create an action to get shipment details" title="Direct link to Create an action to get shipment details">​</a></h2><p>We will start by creating an action that will allow us to get information about a specific shipment. We will use this information to detect if an error has occurred to open an incident on behalf of the user.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="action-properties">Action properties<a href="#action-properties" class="hash-link" aria-label="Direct link to Action properties" title="Direct link to Action properties">​</a></h3><p>On the ServiceNow home screen, search for <strong>flow designer</strong>.</p><p>Click <strong>Flow Designer</strong>, a new window should open.</p><p><img loading="lazy" alt="Configuration menu" src="/yed-spoke-example/assets/images/actions_1-6c8d24b2e107a86124eaf93c42a41fc6.png" width="2560" height="920" class="img_ev3q"></p><p>Once the <strong>Flow Designer</strong> page opens, click the <strong>Create new</strong> button, then select <strong>Action</strong>.</p><p><img loading="lazy" alt="Configuration menu" src="/yed-spoke-example/assets/images/actions_2-2fc809dc87561ebac60cb95a0c473be8.png" width="2560" height="618" class="img_ev3q"></p><p>A menu will appear to configure the action&#x27;s properties. Use the following values to initialize your action.</p><ul><li><strong>Action name</strong>: YubiEnterprise get shipment</li><li><strong>Application</strong>: YubiEnterprise Delivery App</li><li><strong>Description</strong>: Get information about a specific YubiEnterprise shipment</li></ul><p><img loading="lazy" alt="Configuration menu" src="/yed-spoke-example/assets/images/bonus_get_1-fb4900e04abafe1424aefe96ec5c30e9.png" width="1318" height="992" class="img_ev3q"></p><p>Click <strong>Submit</strong>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="action-inputs">Action inputs<a href="#action-inputs" class="hash-link" aria-label="Direct link to Action inputs" title="Direct link to Action inputs">​</a></h3><p>Next we are going to configure the inputs that go into the action. These inputs are the parameters that are going to be passed into our API call by our flow.</p><p>For each row in the table below, perform the following steps:</p><ol><li>Click the <strong>+Create Input</strong> button at the top.</li><li>Fill in the input using the data provided below to the corresponding field (note that name will be automatically input).</li></ol><table><thead><tr><th>Label</th><th>Type</th><th>Mandatory</th></tr></thead><tbody><tr><td>Shipment ID</td><td>String</td><td>on</td></tr></tbody></table><p>Your actions input menu should look like the example below.</p><p><img loading="lazy" alt="Inputs menu" src="/yed-spoke-example/assets/images/bonus_get_2-c199ba854871ba4ef2266e00bf32174f.png" width="3574" height="778" class="img_ev3q"></p><p>Click <strong>Save</strong> once your inputs are complete.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="api-rest-call">API REST call<a href="#api-rest-call" class="hash-link" aria-label="Direct link to API REST call" title="Direct link to API REST call">​</a></h3><p>Next we will configure the action step for making the REST HTTP call to the YubiEnterprise Delivery API.</p><p>On the left side, in the Action Outline, click the <strong>bottom</strong> blue <strong>+</strong> button.</p><p><img loading="lazy" alt="Add second action" src="/yed-spoke-example/assets/images/bonus_get_3-e71265225909e5dcdd4dbe6e788d5dd3.png" width="748" height="374" class="img_ev3q"></p><p>Search for <strong>rest</strong> and select the <strong>REST</strong> option</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>If the REST option does not appear then you have not activated the IntegrationHub plugin. Follow the instructions in the <a href="/yed-spoke-example/docs/prereqs">prerequisites</a> section.</p></div></div><p><img loading="lazy" alt="Inputs menu" src="/yed-spoke-example/assets/images/actions_10-35c8b3dc1042df1274941090fd71c58c.png" width="1840" height="578" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="connection-details">Connection details<a href="#connection-details" class="hash-link" aria-label="Direct link to Connection details" title="Direct link to Connection details">​</a></h4><p>First we will add our API credentials to the REST call. We will utilize the connection alias that was created earlier in this guide.</p><p>Ensure that the Connection field is set to <strong>Use Connection Alias</strong>.</p><p>Change the <strong>Connection Alias</strong> to the one created earlier in the guide. The <strong>Base URL</strong> should be set automatically based on the connection alias.</p><p>Your connection details should look like the example below.</p><p><img loading="lazy" alt="Connection details final" src="/yed-spoke-example/assets/images/actions_11-c331950ddd19f34be8467ffe0796161c.png" width="1538" height="438" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="request-details">Request details<a href="#request-details" class="hash-link" aria-label="Direct link to Request details" title="Direct link to Request details">​</a></h4><p>Next we will configure the details of the API method call. We will be utilizing the <a href="https://console.yubico.com/apidocs/#tag/shipments/operation/GetShipmentExactById" target="_blank" rel="noopener noreferrer"><code>GET /shipments_exact/{id}</code></a> API method</p><p>Configure the Request Details section with the following values:</p><ul><li><strong>Build Request</strong>: Manually</li><li><strong>Resource Path</strong>: Type <strong>/shipments_exact/</strong> then drag the <strong>Shipment ID</strong> data pill to the end of the url (see the image below for an example)</li><li><strong>HTTP Method</strong>: GET</li></ul><p>The <strong>Headers</strong> should include two header properties using the values below</p><table><thead><tr><th>Name</th><th>Value</th></tr></thead><tbody><tr><td>Accept</td><td>application/json</td></tr><tr><td>Content-Type</td><td>application/json</td></tr></tbody></table><p>Your request details should look like the example below.</p><p><img loading="lazy" alt="Request details final" src="/yed-spoke-example/assets/images/bonus_get_4-9e9ee62c64a5128cb0875bd7d7d28ca1.png" width="2926" height="938" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="output-script">Output script<a href="#output-script" class="hash-link" aria-label="Direct link to Output script" title="Direct link to Output script">​</a></h3><p>We will now create a script to format the outputs of the action. This will ensure that we are able to not only capture data from a successful shipment, but to identify and understand potential errors with our shipment.</p><p>On the left side, in the Action Outline, click the bottom blue <strong>+</strong> button.</p><p><img loading="lazy" alt="Action outline 3" src="/yed-spoke-example/assets/images/bonus_get_5-c45a3ed3150addc30191b024562858aa.png" width="734" height="490" class="img_ev3q"></p><p>Search for <strong>scripts</strong> and select the <strong>Script</strong> option</p><p><img loading="lazy" alt="Script action step" src="/yed-spoke-example/assets/images/actions_6-aefdb287d08807a9c85cfad94f420ac5.png" width="1870" height="530" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="script-inputs">Script inputs<a href="#script-inputs" class="hash-link" aria-label="Direct link to Script inputs" title="Direct link to Script inputs">​</a></h4><p>We&#x27;ll start by creating the input for the script. We will only create one input, which will be the result of the previous REST step call</p><ol><li>Click the <strong>+Create Variable</strong> button</li><li><strong>Name</strong>: responseBody (case sensitive)</li><li><strong>Value</strong>: Drag the Response Body data pill from the REST step section on the right side of the menu</li></ol><p>Your script inputs menu should look like the example below.</p><p><img loading="lazy" alt="Script action step" src="/yed-spoke-example/assets/images/bonus_get_6-8f0b8642bde2db134ed7e005f3e60795.png" width="2928" height="832" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="adding-the-script">Adding the script<a href="#adding-the-script" class="hash-link" aria-label="Direct link to Adding the script" title="Direct link to Adding the script">​</a></h4><p>Next we are going to add a script to Script field. Copy the script provided below into the Script field.</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">inputs</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> outputs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  outputs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shipment_response</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> inputs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">responseBody</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inputs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">responseBody</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  outputs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shipment_request_id</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shipment_id</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  outputs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shipment_state_id</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shipment_state_id</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  outputs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shipment_state_message</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shipment_state_message</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> messages </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shipment_messages</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token keyword nil" style="color:#00009f">undefined</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shipment_messages</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  outputs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">shipment_messages</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> messages</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inputs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> outputs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="script-outputs">Script outputs<a href="#script-outputs" class="hash-link" aria-label="Direct link to Script outputs" title="Direct link to Script outputs">​</a></h4><p>Lastly, we will add the output variables for the script</p><p>For each row in the table below, perform the following steps:</p><ol><li>Click the <strong>+Create Variable</strong> button at the bottom.</li><li>Fill in the input using the data provided below to the corresponding field (note that name will be automatically input).</li></ol><table><thead><tr><th>Label</th><th>Type</th><th>Mandatory</th></tr></thead><tbody><tr><td>Shipment Response</td><td>String</td><td>off</td></tr><tr><td>Shipment Request ID</td><td>String</td><td>off</td></tr><tr><td>Shipment State ID</td><td>Integer</td><td>off</td></tr><tr><td>Shipment State Message</td><td>String</td><td>off</td></tr><tr><td>Shipment Messages</td><td>String</td><td>off</td></tr></tbody></table><p>Your script outputs menu should look like the example below.</p><p><img loading="lazy" alt="Script outputs" src="/yed-spoke-example/assets/images/actions_16-e0967ddb490200a93bf4521b82954dc0.png" width="2170" height="824" class="img_ev3q"></p><p>Click <strong>Save</strong> once your output script is complete</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="action-outputs">Action outputs<a href="#action-outputs" class="hash-link" aria-label="Direct link to Action outputs" title="Direct link to Action outputs">​</a></h3><p>Lastly we will define the outputs of the action. These outputs will be usable by the final flow that will orchestrate the ordering experience. We want to ensure that the action outputs are able to express details about the shipment, and any issues should they have occurred.</p><p>We will start by clicking the <strong>Outputs</strong> tab in the <strong>Action Outline</strong> pane.</p><p><img loading="lazy" alt="Action outline outputs" src="/yed-spoke-example/assets/images/bonus_get_7-a4bb5dcbb96734155ad9bb9cd017a08f.png" width="660" height="616" class="img_ev3q"></p><p>Next we are going to configure the outputs.</p><p>For each row in the table below, perform the following steps:</p><ol><li>Click the <strong>+Create Output</strong> button at the top.</li><li>Fill in the input using the data provided below to the corresponding field (Note: Unlike the previous examples, the <strong>Name</strong> field is not auto-populated).</li></ol><table><thead><tr><th>Label</th><th>Name</th><th>Type</th><th>Mandatory</th></tr></thead><tbody><tr><td>HTTP Status Code</td><td>http_status_code</td><td>String</td><td>off</td></tr><tr><td>HTTP Error Code</td><td>http_error_code</td><td>String</td><td>off</td></tr><tr><td>HTTP Error Message</td><td>http_error_message</td><td>String</td><td>off</td></tr><tr><td>Shipment Request ID</td><td>shipment_request_id</td><td>String</td><td>off</td></tr><tr><td>Shipment State ID</td><td>shipment_state_id</td><td>Integer</td><td>off</td></tr><tr><td>Shipment State Message</td><td>shipment_state_message</td><td>String</td><td>off</td></tr><tr><td>Shipment Messages</td><td>shipment_messages</td><td>String</td><td>off</td></tr></tbody></table><p>Your actions outputs menu should look like the example below.</p><p><img loading="lazy" alt="Inputs menu" src="/yed-spoke-example/assets/images/actions_18-6a83b61e417d4731bf08c8a11918a623.png" width="1602" height="978" class="img_ev3q"></p><p>Once complete, press the <strong>Exit Edit Mode</strong> button on the top of the menu.</p><p>A new menu should appear showing the outputs you just defined with empty <strong>Value</strong> fields. For each output, you will add a data pill from the <strong>REST step</strong> and <strong>the second</strong> <strong>Script step</strong> sections on the right side of the menu</p><p>Use the table below to correlate the correct data pill to a label.</p><table><thead><tr><th>Label</th><th>Section &gt; Data pill</th></tr></thead><tbody><tr><td>HTTP Status Code</td><td>REST step &gt; Status Code</td></tr><tr><td>HTTP Error Code</td><td>REST step &gt; Error Code</td></tr><tr><td>HTTP Error Message</td><td>REST step &gt; Error message</td></tr><tr><td>Shipment Request ID</td><td>Script step &gt; Shipment Request ID</td></tr><tr><td>Shipment State ID</td><td>Script Step &gt; Shipment State ID</td></tr><tr><td>Shipment State Message</td><td>Script step &gt; Shipment State Message</td></tr><tr><td>Shipment Messages</td><td>Script step &gt; Shipment Messages</td></tr></tbody></table><p>Your actions outputs menu should look like the example below.</p><p><img loading="lazy" alt="Inputs menu" src="/yed-spoke-example/assets/images/actions_19-ba16282ad1a7e3130179d557d6287433.png" width="2242" height="1328" class="img_ev3q"></p><p>Click <strong>Save</strong> once your outputs are complete</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-the-action">Test the action<a href="#test-the-action" class="hash-link" aria-label="Direct link to Test the action" title="Direct link to Test the action">​</a></h3><p>Lastly we want to ensure that a shipment can be made from our action. This will be used to ensure that our API credentials + script + REST call are configured correctly.</p><p>At the top of the Actions menu, click the <strong>Test</strong> button</p><p><img loading="lazy" alt="Inputs menu" src="/yed-spoke-example/assets/images/bonus_get_8-7c996f909cdb3a5e8aeae92c6ffd19b2.png" width="3580" height="332" class="img_ev3q"></p><p>A menu should appear, which will ask for a Shipment ID. This ID will correlate to an actual shipment in your YubiEnterprise Console.</p><p>Please navigate to your YubiEnterprise Console to get a valid Shipment ID. If no orders exist in your system, then attempt to process a new shipment using <a href="/yed-spoke-example/docs/action#test-the-action">the method discussed earlier in this tutorial</a>, or create one directly in the console itself.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>Below are some tips and pitfalls to watch out for in this initial test</p><ul><li>If you receive a 401 error, that means your API credentials are not correct</li><li>If you receive a 400 error, that means that you did not provide a valid shipment. Please create an order in the YubiEnterprise Console, and use the Shipment ID that is provided</li></ul></div></div><p>When ready click the <strong>Run Test</strong> button at the bottom of the screen.</p><p>Wait on the current page until a message appears saying &quot;Your test has finished running. View the action execution details.&quot;</p><p><img loading="lazy" alt="Action test complete" src="/yed-spoke-example/assets/images/actions_21-cfe0e06891b069e25b057ac3705780bd.png" width="1858" height="122" class="img_ev3q"></p><p>Click on the message to see the execution details.</p><p>On the execution details screen, scroll until you see the <strong>Output Data</strong> section. The HTTP Status Code should be 200. If the response was not 200, take a look at the tips above, check the error message output, or expand the <strong>Steps</strong> section at the bottom of the details screen to troubleshoot.</p><p>Below is an example of a successful outputs screen</p><p><img loading="lazy" alt="Execution details" src="/yed-spoke-example/assets/images/bonus_get_9-a9a123b62f817753579ce9952b77a313.png" width="3580" height="1620" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="delete-the-test-order">Delete the test order<a href="#delete-the-test-order" class="hash-link" aria-label="Direct link to Delete the test order" title="Direct link to Delete the test order">​</a></h3><div class="theme-admonition theme-admonition-danger alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_S0QG"><p>After every test it is important that you delete any orders directly in the YubiEnterprise Console - See more information here - <a href="https://github.com/YubicoLabs/yed-spoke-example#cancelling-my-test-order" target="_blank" rel="noopener noreferrer">Cancelling Your Test Orders</a></p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="publish-the-action">Publish the action<a href="#publish-the-action" class="hash-link" aria-label="Direct link to Publish the action" title="Direct link to Publish the action">​</a></h3><p>If everything looks good, click the <strong>Publish</strong> button at the top of the action menu to make the action available for all flows.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="update-the-create-shipment-flow">Update the create shipment flow<a href="#update-the-create-shipment-flow" class="hash-link" aria-label="Direct link to Update the create shipment flow" title="Direct link to Update the create shipment flow">​</a></h2><p>We will now update the <a href="/yed-spoke-example/docs/flow">flow created earlier in this guide</a> to monitor a shipment&#x27;s activity, and to open an incident if an error were to occur. We will add a loop to the end of the existing flow to continuously check the created shipment for errors. The flow will be closed once the shipment has been marked as received, or if an incident was opened due to an error.</p><p>On your current screen, click the <strong>Home</strong> icon on the top left of the screen.</p><p><img loading="lazy" alt="Return home" src="/yed-spoke-example/assets/images/bonus_get_10-8877b51db9c310df35affa70f5e9066c.png" width="874" height="354" class="img_ev3q"></p><p>From the <strong>Flow Designer</strong> home screen, ensure the <strong>Flows</strong> tab is selected.</p><p>In the search field type <strong>Yubi</strong> then click enter. The flow that we previously created should appear, titled <strong>YubiEnterprise create shipment</strong>.</p><p><img loading="lazy" alt="Flow designer home" src="/yed-spoke-example/assets/images/bonus_get_11-57880d19c494646584f6290649d29a3f.png" width="2650" height="926" class="img_ev3q"></p><p>Click into the flow.</p><p>You should now be in the <strong>YubiEnterprise create shipment</strong> flow.</p><p><img loading="lazy" alt="Flow overview" src="/yed-spoke-example/assets/images/bonus_get_12-7398a6ba384f4ff4e223cd5688696348.png" width="1096" height="1110" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-flow-variable">Create flow variable<a href="#create-flow-variable" class="hash-link" aria-label="Direct link to Create flow variable" title="Direct link to Create flow variable">​</a></h3><p>We will need to create a flow variable to keep track of the current shipment state ID. Perform the steps below to create a flow variable.</p><ol><li>Click the 3 dots on the top right of the screen</li><li>Click <strong>Flow Variables</strong></li><li>Click the small <strong>+</strong> button on the right of the pop-up menu</li><li>Set the <strong>Label</strong> to <strong>Current shipment state ID</strong>.</li><li>Set the <strong>Type</strong> to <strong>Integer</strong></li></ol><p>Your final settings should resemble the image below.</p><p><img loading="lazy" alt="Set flow variables" src="/yed-spoke-example/assets/images/bonus_get_13-18f43d189bc52e64e39a1a4b51b35ab0.png" width="1494" height="408" class="img_ev3q"></p><p>When complete, click the <strong>X</strong> button on the top right of the pop-up.</p><p>If you scroll to the top of the <strong>Data</strong> window on the right side, you should see your new flow variable.</p><p><img loading="lazy" alt="Set flow variables" src="/yed-spoke-example/assets/images/bonus_get_14-ee49ffd5cff2ade21fa60a89cc81874b.png" width="616" height="416" class="img_ev3q"></p><p>We will now set the flow variable using the <strong>shipment_state_id</strong> that was provided when we created the shipment.</p><p>At the bottom of the flow click the <strong>+ Add an Action, Flow Logic, or Subflow</strong> button.</p><p>Next, select <strong>Flow Logic</strong>.</p><p>Next, search for <strong>set</strong>, then select <strong>Set Flow Variables</strong>.</p><p><img loading="lazy" alt="Set flow variables" src="/yed-spoke-example/assets/images/bonus_get_15-9cabc7d52d7ea43f85983f018527f7aa.png" width="1156" height="416" class="img_ev3q"></p><p>A new menu will appear. Begin by clicking the <strong>+</strong> button in the new menu.</p><p>In the <strong>Name</strong> field, select the flow variable <strong>Current shipment state ID</strong>.</p><p>Drag the <strong>Shipment State ID</strong> value from the <strong>Data</strong> window on the right, in the <strong>2 - YubiEnterprise create shipment</strong> section.</p><p>Your resulting menu should resemble the image below.</p><p><img loading="lazy" alt="Set flow variables final" src="/yed-spoke-example/assets/images/bonus_get_16-16ebd025aaf1276527551f7a2df5c601.png" width="3524" height="942" class="img_ev3q"></p><p>When complete, click <strong>Done</strong>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-daily-cron-job">Create daily cron job<a href="#create-daily-cron-job" class="hash-link" aria-label="Direct link to Create daily cron job" title="Direct link to Create daily cron job">​</a></h3><p>Next we will create a cron job that will continuously monitor the shipment that was previously created in the flow. The YubiEnterprise API does not provide webhooks, so we will need to continuously poll the API to catch any changes.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>How often should my cron job run?</div><div class="admonitionContent_S0QG"><p>Due to the physical and logistical nature of a shipment, the state doesn&#x27;t undergo rapid changes in a single day. Due to these considerations, we recommend that you poll the API <strong>once</strong> or <strong>twice</strong> a day.</p><p>You may also consider adding a check that occurs ~15 mins after the initial creation of a shipment to ensure that all of the data was properly validated.</p><p>This example focuses only on the mechanism that runs once a day at a designated time - but the same foundational steps can be used to create a variety of timers based on your use case.</p></div></div><p>First we will create a conditional loop that will run until the shipment has been marked as delivered. Delivered is indicated by the <strong>shipment_state_id</strong> of 104.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>The full list of shipment states can be found <a href="https://console.yubico.com/help/api-tracking.html#shipment-status-codes" target="_blank" rel="noopener noreferrer">here</a>.</p></div></div><p>Follow the steps below to create the conditional loop.</p><ol><li>Click <strong>Add an Action, Flow Logic, or Subflow</strong></li><li>Click <strong>Flow Logic</strong></li><li>Select <strong>Do the following until</strong></li></ol><p><img loading="lazy" alt="Create iterator" src="/yed-spoke-example/assets/images/bonus_get_17-7bbd4f332271522cb29072165596678a.png" width="1324" height="942" class="img_ev3q"></p><p>A new menu should appear. Configure it with the following values:</p><ul><li><strong>Condition Label</strong>: Shipment is delivered</li><li><strong>Condition 1</strong><ul><li>Drag the <strong>Current shipment state ID</strong> flow variable into the first box</li><li>Keep the condition as <strong>is</strong></li><li>In the third box, type <strong>104</strong></li></ul></li></ul><p>Your final menu should resemble the image below.</p><p><img loading="lazy" alt="Set iterator" src="/yed-spoke-example/assets/images/bonus_get_18-a4db0efa950974bf16cd6e0fc9b86770.png" width="2866" height="666" class="img_ev3q"></p><p>When complete, click <strong>Done</strong>.</p><p>Within the <strong>Do the following</strong> section we are going to add our timer using the instructions below:</p><ol><li>Click <strong>Add an Action, Flow Logic, or Subflow</strong></li><li>Click <strong>Flow Logic</strong></li><li>Select <strong>Wait for a duration of time</strong></li></ol><p><img loading="lazy" alt="Add wait" src="/yed-spoke-example/assets/images/bonus_get_19-0bcac63a7a50ec8e03562fd774126f56.png" width="1426" height="882" class="img_ev3q"></p><p>A new menu should appear. Configure it with the following values:</p><ul><li><strong>Duration Type</strong>: Explicit duration</li><li><strong>Wait for</strong>: 24 h</li><li><strong>During the following schedule</strong>: 24 x 7</li></ul><p>Your final menu should resemble the image below.</p><p><img loading="lazy" alt="Wait configs" src="/yed-spoke-example/assets/images/bonus_get_20-d66bfb0b93902a56a7392d055ba94577.png" width="1328" height="586" class="img_ev3q"></p><p>When complete, click <strong>Done</strong>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="call-the-get-shipment-details-action">Call the get shipment details action<a href="#call-the-get-shipment-details-action" class="hash-link" aria-label="Direct link to Call the get shipment details action" title="Direct link to Call the get shipment details action">​</a></h2><p>Next, we are going to use the action that we created previously in this section.</p><p>We will begin by adding the get shipment details action to the conditional loop.</p><p>Within the <strong>Do the following</strong> section we are going to add our custom action using the instructions below:</p><ol><li>Click the <strong>+</strong> button under the <strong>Wait</strong> step you just added</li><li>Click <strong>Add an Action, Flow Logic, or Subflow</strong></li><li>Click <strong>Action</strong></li><li>Search for <strong>yubienterprise get shipment</strong>, and select <strong>YubiEnterprise get shipment</strong>.</li></ol><p><img loading="lazy" alt="Add get action" src="/yed-spoke-example/assets/images/bonus_get_21-7718319c1cea42557c1d9d805d4d3280.png" width="688" height="567" class="img_ev3q"></p><p>For the field <strong>Shipment ID</strong>, drag the <strong>Shipment Request ID</strong> data pill from the <strong>Data</strong> window, in the section titled <strong>2 - YubiEnterprise create shipment</strong>.</p><p><img loading="lazy" alt="Add get action shipment ID" src="/yed-spoke-example/assets/images/bonus_get_22-8501a7589341e0c2f396fdf7d140b3e2.png" width="1772" height="333" class="img_ev3q"></p><p>When complete, click <strong>Done</strong>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="evaluate-the-shipment-state-id-for-errors">Evaluate the shipment state ID for errors<a href="#evaluate-the-shipment-state-id-for-errors" class="hash-link" aria-label="Direct link to Evaluate the shipment state ID for errors" title="Direct link to Evaluate the shipment state ID for errors">​</a></h2><p>Now that we have updated details for our specific shipment, we are going to evaluate the new shipment state ID to see if an error occurred.</p><p>Using <a href="https://console.yubico.com/help/api-tracking.html#shipment-status-codes" target="_blank" rel="noopener noreferrer">this list of shipment state IDs and meanings</a>, we can evaluate the errors that can occur, and take a specific action based on our requirements. A summary of errors can be found in the table below.</p><table><thead><tr><th>Shipment state ID</th><th>Shipment state message</th></tr></thead><tbody><tr><td>1</td><td>Incomplete Shipping Request</td></tr><tr><td>6</td><td>Incomplete</td></tr><tr><td>7</td><td>Address is undeliverable or could not be understood</td></tr><tr><td>8</td><td>Error: Processing Error, contact Support</td></tr><tr><td>9</td><td>Error: DPL Match</td></tr><tr><td>99</td><td>Error: Shipping error, contact Support</td></tr><tr><td>105</td><td>Shipment Lost/Missing</td></tr><tr><td>106</td><td>Delivery Exception</td></tr></tbody></table><p>To simplify this exercise, we will only evaluate errors that occur for shipment state ID <strong>7</strong> and <strong>105</strong>. In your final implementation you can decide to process all errors, or a subset based on your requirements.</p><p>First we&#x27;ll start by setting the <strong>Flow Variable Current Shipment State ID</strong> to the updated state provided by the <strong>YubiEnterprise get shipment</strong> action.</p><p>These steps should resemble the ones taken earlier on this page. Under the <strong>YubiEnterprise get shipment</strong> action click the <strong>+ Add an Action, Flow Logic, or Subflow</strong> button.</p><p>Next, select <strong>Flow Logic</strong>.</p><p>Next, search for <strong>set</strong>, then select <strong>Set Flow Variables</strong>.</p><p>A new menu will appear. Begin by clicking the <strong>+</strong> button in the new menu.</p><p>In the <strong>Name</strong> field, select the flow variable <strong>Current shipment state ID</strong>.</p><p>Drag the <strong>Shipment State ID</strong> value from the <strong>Data</strong> window on the right, in the <strong>6 - YubiEnterprise get shipment</strong> section.</p><p>Your resulting menu should resemble the image below.</p><p><img loading="lazy" alt="Set flow variables final" src="/yed-spoke-example/assets/images/bonus_get_23-875fe362b9ded3f433b01fc1d80fbeb0.png" width="3544" height="702" class="img_ev3q"></p><p>When complete, click <strong>Done</strong>.</p><p>Click <strong>Done</strong>.</p><p>Next, we&#x27;re going to add a conditional check to see if any of the errors that we noted above (7 and 105) have occurred.</p><p>Under the <strong>Set Flow Variables</strong> action click the <strong>+ Add an Action, Flow Logic, or Subflow</strong> button.</p><p>Next, select <strong>Flow Logic</strong>.</p><p>Next, search for <strong>if</strong>, then select <strong>If</strong>.</p><p><img loading="lazy" alt="Set flow variables final" src="/yed-spoke-example/assets/images/bonus_get_24-5073db5416b65d3b69a3f9ef3f1822f7.png" width="1178" height="736" class="img_ev3q"></p><p>A new menu should appear. Configure it with the following values:</p><ul><li><strong>Condition Label</strong>: Shipment error has occurred</li><li><strong>Condition 1</strong><ul><li>Drag the <strong>Current shipment state ID</strong> flow variable into the first box</li><li>Keep the condition as <strong>is</strong></li><li>In the third box, type <strong>7</strong></li><li>Click the red <strong>or</strong> button to the right of the entry</li></ul></li><li><ul><li><strong>Condition 2</strong></li><li>Drag the <strong>Current shipment state ID</strong> flow variable into the first box</li><li>Keep the condition as <strong>is</strong></li><li>In the third box, type <strong>105</strong></li></ul></li></ul><p>Your final menu should resemble the image below.</p><p><img loading="lazy" alt="Detect error config" src="/yed-spoke-example/assets/images/bonus_get_25-7816fe81c5369d476728ce1a040e1260.png" width="3560" height="818" class="img_ev3q"></p><p>When complete, click <strong>Done</strong>.</p><p>Under the new <strong>If</strong> step, click the <strong>then +</strong> button.</p><p>Click <strong>Action</strong>.</p><p>Search for <strong>create record</strong>. Select <strong>Create Record</strong> in the <strong>ServiceNow Core</strong> category.</p><p><img loading="lazy" alt="Detect error config" src="/yed-spoke-example/assets/images/bonus_get_26-9f49438aaf48b7d425281ff293315a53.png" width="1588" height="926" class="img_ev3q"></p><p>A new menu should appear. Configure it with the following values:</p><ul><li><strong>Table</strong>: Select Incident <!-- -->[<!-- -->incident<!-- -->]</li><li>Click the Add field value button 3 times. Add the following fields and values<ul><li><strong>Short description</strong>: YubiEnterprise Shipment has failed for an unknown reason</li><li><strong>Description</strong>: YED Shipment <!-- -->[<!-- -->Add shipment request ID data pill<!-- -->]<!-- --> has failed. Please check the YubiEnterprise console to begin troubleshooting. <a href="https://console.yubico.com/shipments/" target="_blank" rel="noopener noreferrer">https://console.yubico.com/shipments/</a> <!-- -->[<!-- -->Add shipment request ID data pill<!-- -->]</li><li><strong>Caller</strong>: Add the data pill Trigger &gt; Requested Item Record &gt; Created By</li></ul></li></ul><p>Your configurations should look like the image below.</p><p><img loading="lazy" alt="Create incident config" src="/yed-spoke-example/assets/images/bonus_get_27-d71ebf1009e027252c215d686d4c15a0.png" width="3528" height="926" class="img_ev3q"></p><p>When complete click <strong>Done</strong>.</p><p>In order to prevent an influx of incidents from opening in your ServiceNow instance, we will end the flow when an error occurs, and will assume that the shipment will continue to be tracked by your internal incident process.</p><p>Click the plus button after the <strong>Create Incident Record</strong> step that we just added.</p><p>Click <strong>Flow Logic</strong></p><p>Select <strong>End Flow</strong></p><p>Your final flow additions should look like the image below.</p><p><img loading="lazy" alt="Create flow final" src="/yed-spoke-example/assets/images/bonus_get_28-3969b30772ec6c0288b374517d1b6ad8.png" width="920" height="1314" class="img_ev3q"></p><p>Finally we&#x27;re going to activate the flow, and get our custom catalog item to trigger it when a new request is made.</p><p>Click the <strong>Save</strong> button at the top of the screen. Once the flow is done saving click <strong>Activate</strong>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-the-solution">Test the solution<a href="#test-the-solution" class="hash-link" aria-label="Direct link to Test the solution" title="Direct link to Test the solution">​</a></h2><p>To ensure this is working correctly, we will test the end-to-end flow. Our primary goal is to have a shipment get accepted by the API, that will fail the initial address validation.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>You may want to change the <strong>Wait</strong> time for your initial test. YubiEnterprise will require a few minutes to process your real shipment - so setting this value between 30mins to an hour may suffice for this initial test.</p></div></div><p>Use the following values to create a new shipment test, using the <a href="/yed-spoke-example/docs/flow#test-the-flow">method used earlier in this guide</a>.</p><table><thead><tr><th>Name</th><th>Value</th></tr></thead><tbody><tr><td>Who is this request for</td><td>{current user}</td></tr><tr><td>When do you need this?</td><td>Today</td></tr><tr><td>Quantity</td><td>1</td></tr><tr><td>Phone Number</td><td>5555555555</td></tr><tr><td>Street address</td><td>123 XYZ</td></tr><tr><td>Apt or Unit #</td><td></td></tr><tr><td>City</td><td>Nowhere</td></tr><tr><td>Postal Code</td><td>11111</td></tr><tr><td>Region</td><td>California</td></tr><tr><td>Country Code 2</td><td>US</td></tr><tr><td>Recipient</td><td>Example Inc.</td></tr><tr><td>YubiKey model</td><td>YubiKey 5 NFC</td></tr></tbody></table><p>Let the flow run, and wait for the shipment to process. If you have the YubiEnterprise console open, you may note that the shipment has thrown an error that indicates &quot;Address is undeliverable or could not be understood&quot;.</p><p>If you open your <strong>incidents</strong> table in ServiceNow, you will note that a new incident has been created.</p><p><img loading="lazy" alt="Incident table" src="/yed-spoke-example/assets/images/bonus_get_29-e89c5c38f9cc09ebd61f6520d4405a26.png" width="3566" height="370" class="img_ev3q"></p><p>You can open the incident and see information about the specific shipment, including a link that will take you directly to the shipment in the YubiEnterprise console.</p><p><img loading="lazy" alt="Incident details" src="/yed-spoke-example/assets/images/bonus_get_30-707b3556d4cab2f2a007a2d47be78d26.png" width="3584" height="1076" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/YubicoLabs/yed-spoke-example/tree/main/docs/docs/advanced-topics/update_shipment_status.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/yed-spoke-example/docs/category/advanced-use-cases"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Advanced use cases</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/yed-spoke-example/docs/advanced-topics/low_inventory_monitor"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Monitor for low organizational inventory</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#create-an-action-to-get-shipment-details" class="table-of-contents__link toc-highlight">Create an action to get shipment details</a><ul><li><a href="#action-properties" class="table-of-contents__link toc-highlight">Action properties</a></li><li><a href="#action-inputs" class="table-of-contents__link toc-highlight">Action inputs</a></li><li><a href="#api-rest-call" class="table-of-contents__link toc-highlight">API REST call</a></li><li><a href="#output-script" class="table-of-contents__link toc-highlight">Output script</a></li><li><a href="#action-outputs" class="table-of-contents__link toc-highlight">Action outputs</a></li><li><a href="#test-the-action" class="table-of-contents__link toc-highlight">Test the action</a></li><li><a href="#delete-the-test-order" class="table-of-contents__link toc-highlight">Delete the test order</a></li><li><a href="#publish-the-action" class="table-of-contents__link toc-highlight">Publish the action</a></li></ul></li><li><a href="#update-the-create-shipment-flow" class="table-of-contents__link toc-highlight">Update the create shipment flow</a><ul><li><a href="#create-flow-variable" class="table-of-contents__link toc-highlight">Create flow variable</a></li><li><a href="#create-daily-cron-job" class="table-of-contents__link toc-highlight">Create daily cron job</a></li></ul></li><li><a href="#call-the-get-shipment-details-action" class="table-of-contents__link toc-highlight">Call the get shipment details action</a></li><li><a href="#evaluate-the-shipment-state-id-for-errors" class="table-of-contents__link toc-highlight">Evaluate the shipment state ID for errors</a></li><li><a href="#test-the-solution" class="table-of-contents__link toc-highlight">Test the solution</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Other resources and guides</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://developers.yubico.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">developers.yubico.com</a></li><li class="footer__item"><a href="https://yubicolabs.github.io/passkey-workshop/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Passkey workshop</a></li><li class="footer__item"><a href="https://yubicolabs.github.io/secure-software-supply-chain-guide/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Secure software supply chain guide</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/yubico" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Yubico © 2024. Built with Docusaurus.</div></div></div></footer></div>
<script src="/yed-spoke-example/assets/js/runtime~main.66cb5edb.js"></script>
<script src="/yed-spoke-example/assets/js/main.5567d05f.js"></script>
</body>
</html>